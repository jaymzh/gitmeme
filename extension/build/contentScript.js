!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GITHUB_CLIENT_ID="9b9e17e168e82438cfb6",t.API_ROOT_URL="http://localhost:5000/git-meme-prod/us-central1/api"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return{Authorization:`Bearer ${e}___${t}`,"Content-Type":"application/json"}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function l(e){try{u(o.next(e))}catch(e){r(e)}}function a(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(l,a)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.getGithubInfo=function(){return o(this,void 0,void 0,function*(){return new Promise(e=>{chrome.storage.sync.get(["github_token","github_id","github_avatar"],function(t){e({token:t.github_token||null,id:t.github_id||null,avatar:t.github_avatar||null})})})})},t.setGithubToken=function(e){return o(this,void 0,void 0,function*(){return new Promise(t=>{chrome.storage.sync.set({github_token:e},function(){t()})})})},t.setGithubUserId=function(e,t){return o(this,void 0,void 0,function*(){return new Promise(n=>{console.log("setGithubUserId ",e,t),chrome.storage.sync.set({github_id:e,github_avatar:t},function(){n()})})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(4),i=n(5),r=n(9),l=n(10),a=n(11),u=n(2),s=n(0),d=n(1);let c;function f(e){let t=[];const n=r.default(()=>{let n=o.default(e.value);if(n.length>0){n.filter(e=>!t.some(t=>t.token.index===e.index&&t.token.value===e.value)).forEach(n=>{const o=i.default(e,n);t.push(o)})}t=t.filter(e=>{const t=n.some(t=>e.token.index===t.index&&e.token.value===t.value);return t||e.remove(),t})},500);let a=l.default(e,"form");function u(){t.forEach(e=>{e.remove()}),t=[],e.removeEventListener("keyup",n),e.removeEventListener("change",n),e.removeEventListener("focus",n),a.removeEventListener("submit",f,!0)}function f(n){t.sort((e,t)=>e.token.index>t.token.index?-1:t.token.index>e.token.index?1:0);let o=e.value;t.forEach(e=>{e.isValid&&!e.disabled&&(o=o.substring(0,e.token.index)+`<img src="${e.imageUrl}" title="Created by gitme.me with /${e.token.value}"/>`+o.substring(e.token.index+e.token.value.length+1),c&&c.id&&fetch(`${s.API_ROOT_URL}/add_token_by_url`,{method:"POST",headers:Object.assign({},d.default(c.id,c.token)),body:JSON.stringify({image_url:e.imageUrl,token:e.token.value})}))}),e.value=o,u()}return e.addEventListener("keyup",n),e.addEventListener("change",n),e.addEventListener("focus",n),a.addEventListener("submit",f,!0),new MutationObserver(function(t){console.log("mutation event",t),console.log("input.offsetHeight",e.offsetHeight),t[0].removedNodes&&Array.from(t[0].removedNodes).indexOf(e)>-1?u():0===e.offsetHeight&&u()}).observe(a,{childList:!0}),n(),{input:e,remove:u}}u.getGithubInfo().then(e=>{c=e,console.log("Got local user info",e),a.default(f)})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=/(?<!\w)\/\w+/g,i={"\n":!0,"\t":!0," ":!0};t.default=function(e){const t=[];let n;do{if(n=o.exec(e)){const o=n.index;let r=o+n[0].length===e.length;if(!r){const t=e.charAt(o+n[0].length);console.log("letterAfter is ",t," for ",n[0]),r=!!i[t]}console.log("got endIsValid ",r," for ",n[0]);let l=0===o;if(!l){const t=e.charAt(o-1);l=!!i[t]}console.log("got startIsValid ",l," for ",n[0]),l&&r&&t.push({index:n.index,value:n[0].substring(1).trim()})}}while(n);return console.log("parseTokens",t),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),i=n(7),r="__tagContainer",l=18;let a=null;t.default=function(e,t){const n=o(e,t.index),u=o(e,t.index+t.value.length+1);let s=document.getElementById(r);s||((s=document.createElement("div")).id=r,document.body.appendChild(s));const d=document.createElement("div");let c=null;function f(){c&&c.parentNode&&c.parentNode.removeChild(c),c=null,a===f&&(a=null),m()}function g(){b.disabled=!0,f()}function h(){b.disabled=!1,f()}function m(){let e="";if(d.classList.toggle("imageFound",!!b.imageUrl),d.classList.toggle("imageNotFound",!b.imageUrl),b.imageUrl,e=`GitMeme for "${t.value}"`,d.classList.toggle("disabled",b.disabled),c&&c.classList.toggle("disabled",b.disabled),b.disabled&&(e="GitMeme image disabled"),c){c.classList.toggle("hasMultipleImages",b.imageUrls.length>1);const e=c.querySelector("img");e.src!==b.imageUrl&&(e.src=b.imageUrl)}d.title=e}function p(){const e=document.createElement("div");e.className="__imageSelector",e.innerHTML=`\n      <div class="__imageSelectorTitle">Choose One Image</div>\n        ${b.imageUrls.map((e,t)=>`<a href="#" data-index="${t}"><img src="${e}" /></a>`).join("\n")}\n    `,s.appendChild(e),e.addEventListener("click",t=>{let n=t.target,o=n.tagName.toLowerCase();"img"===o&&(o=(n=n.parentElement).tagName.toLowerCase()),"a"===o&&(b.imageUrl=b.imageUrls[n.getAttribute("data-index")],m()),s.removeChild(e)})}function v(){const t=e.getBoundingClientRect(),o=l+window.scrollY+t.top+n.top,i=window.scrollX+t.left+n.left;d.style.top=o+"px",d.style.left=i+"px",d.style.width=u.left-n.left+"px",c&&(c.style.top=o+2+"px",c.style.left=i+"px")}d.className="__tokenTag",d.setAttribute("data-token",t.value),s.appendChild(d),d.addEventListener("click",e=>{if(b.imageUrl)if(c)f();else{a&&a(),(c=document.createElement("div")).className="__tokenTagThumbnail";const e=document.createElement("img");e.src=b.imageUrl;const t=document.createElement("button");t.textContent=b.disabled?"Enable Tag":"Disable Tag",c.appendChild(e),c.appendChild(t),e.addEventListener("click",f),t.addEventListener("click",b.disabled?h:g);const n=document.createElement("button");n.className="__showAllImages",n.textContent=`+${b.imageUrls.length-1}`,n.addEventListener("click",p),c.appendChild(n),m(),s.appendChild(c),a=f,v()}}),v();const b={input:e,remove:function(){d.parentNode.removeChild(d),f()},reposition:v,token:t,isValid:!1,imageUrl:null,imageUrls:[],disabled:!1};return console.log("searching for ",t.value),i.default(t.value).then(e=>{const t=e.length>0?e[0]:null;b.imageUrl=t,b.imageUrls=e,b.isValid=!!t,m()}),b}},function(e,t,n){!function(){var t=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n="undefined"!=typeof window,o=n&&null!=window.mozInnerScreenX;function i(e,i,r){if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var l=r&&r.debug||!1;if(l){var a=document.querySelector("#input-textarea-caret-position-mirror-div");a&&a.parentNode.removeChild(a)}var u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);var s=u.style,d=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,c="INPUT"===e.nodeName;s.whiteSpace="pre-wrap",c||(s.wordWrap="break-word"),s.position="absolute",l||(s.visibility="hidden"),t.forEach(function(e){c&&"lineHeight"===e?s.lineHeight=d.height:s[e]=d[e]}),o?e.scrollHeight>parseInt(d.height)&&(s.overflowY="scroll"):s.overflow="hidden",u.textContent=e.value.substring(0,i),c&&(u.textContent=u.textContent.replace(/\s/g,"Â "));var f=document.createElement("span");f.textContent=e.value.substring(i)||".",u.appendChild(f);var g={top:f.offsetTop+parseInt(d.borderTopWidth),left:f.offsetLeft+parseInt(d.borderLeftWidth),height:parseInt(d.lineHeight)};return l?f.style.backgroundColor="#aaa":document.body.removeChild(u),g}void 0!==e.exports?e.exports=i:n&&(window.getCaretCoordinates=i)}()},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function l(e){try{u(o.next(e))}catch(e){r(e)}}function a(e){try{u(o.throw(e))}catch(e){r(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(l,a)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),r=n(0),l=n(1),a=n(2),u="I5ysXzZG4OIoiMD99Tz7v6AGN9uzGWpr";t.default=function(e){return o(this,void 0,void 0,function*(){return e?new Promise((t,n)=>o(this,void 0,void 0,function*(){let n=[],d=!1,c=null;const f=`${r.API_ROOT_URL}/search?t=${encodeURIComponent(e)}`,g=yield a.getGithubInfo();i(f,{headers:Object.assign({},l.default(g.id,g.token))}).then(function(e){if(!e.ok)throw Error(e.statusText);return e.json()}).then(function(o){console.log("gitmeme value for ",e,o),d=!0,o&&o.url?(n.unshift(o.url),t(n)):c&&t(n)}).catch(function(e){console.log("Looks like there was a problem: \n",e)});try{(c=yield function(e){return o(this,void 0,void 0,function*(){return s[e]||(s[e]=new Promise((t,n)=>o(this,void 0,void 0,function*(){let n=8;for(;n>2;)try{const o=yield i(`https://api.giphy.com/v1/gifs/search?q=${encodeURIComponent(e)}&api_key=${u}&limit=${n}`);console.log("giphy result",o);const r=yield o.json();t(r);break}catch(e){console.error(e),n--}}))),s[e]})}(e)).data&&c.data.length>0&&(console.log("giphyResult for ",e,c.data[0]),c.data.map(e=>e.images.downsized_medium.url).forEach(e=>{n.push(e)}),d&&n.length===c.data.length&&t(n))}catch(e){console.error(e)}return[]})):null})};const s={}},function(e,t,n){"use strict";var o=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==o)return o;throw new Error("unable to locate global object")}();e.exports=t=o.fetch,t.default=o.fetch.bind(o),t.Headers=o.Headers,t.Request=o.Request,t.Response=o.Response},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var o,i,r,l=null,a=0;n||(n={});var u=function(){a=!1===n.leading?0:Date.now(),l=null,r=e.apply(o,i),l||(o=i=null)};return function(){var s=Date.now();a||!1!==n.leading||(a=s);var d=t-(s-a);return o=this,i=arguments,d<=0||d>t?(l&&(clearTimeout(l),l=null),a=s,r=e.apply(o,i),l||(o=i=null)):l||!1===n.trailing||(l=setTimeout(u,d)),r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n=e.parentElement;for(;n&&n.tagName.toLowerCase()!==t;)n=n.parentElement;return n||null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=Array.from(document.querySelectorAll(["new_comment_field","issue_body"].map(e=>`#${e}`).join(",")));console.log("inputsById",t);let n=t.map(e);document.body.addEventListener("focusin",t=>{const o=t.target,i=o.tagName;i&&"textarea"===i.toLowerCase()&&!n.some(e=>e.input===o)&&n.push(e(o))}),setInterval(()=>{const e=function(e){return e.filter(e=>!!e.input.offsetParent||(console.log("Cleaning up",e.input),e.remove(),!1))}(n);e.length!==n.length&&(n=e)},200)}}]);